<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Tuesday, December 21, 2021, 8:30 PM -->
<!-- MuClient version 5.06-pre -->

<!-- Plugin "newbie_greeter" generated by Plugin Wizard -->

<muclient>
<plugin
   name="newbie_greeter"
   author="Kelaire"
   id="38012221ed4dbf4f0563505f"
   language="Lua"
   purpose="Random Newbie Greetings!"
   date_written="2021-12-21 20:29:40"
   requires="5.06"
   version="1.0"
   >

</plugin>

<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Aliases  -->

<aliases>
  <alias
   match="^ngreet (?<playername>.*)$"
   enabled="y"
   regexp="y"
   script="new_greet"
   sequence="100"
  >
  </alias>
  
  <alias
   match="^ngreet add (?<message>.*)$"
   enabled="y"
   regexp="y"
   script="add_greeting"
   sequence="1"
  >
  </alias>
  
  <alias
   match="^ngreet del (?<messageNo>.*)$"
   enabled="y"
   regexp="y"
   script="del_greeting"
   sequence="1"
  >
  </alias>
  
   <alias
   match="^ngreet list$"
   enabled="y"
   regexp="y"
   script="list_greeting"
   sequence="1"
  >
  </alias>
  
    
   <alias
   match="^ngreet help$"
   enabled="y"
   regexp="y"
   script="help"
   sequence="1"
  >
  </alias>
</aliases>

<script>

<![CDATA[

require "serialize"

function new_greet(name, line, args)
	-- Get the list of greetings
	loadstring(GetVariable("greet_list"))
	
	-- Get the player name from the passed argument
	playerName = args.playername

	-- Get max in table, randomize, get greeting.
	numMessages = #greetings
	randomNum = math.random(1,numMessages)
	randomGreeting = greetings[randomNum]
	
	-- Replace %%1 with playerName
	randomGreeting = string.gsub(randomGreeting,"__PLAYERNAME__",playerName)
	
	Execute("newbie "..randomGreeting)
	ColourNote("Green","",randomGreeting)
end

function add_greeting(name, line, args)
	-- Get the list of greetings
	loadstring(GetVariable("greet_list"))
	
	-- Get the new greeting
	newGreet = args.message
	
	-- Put it in the table
	table.insert(greetings, newGreet)
	
	-- Let the user know
	ColourNote("#6600CC", "", "[", "#66FF66", "", "Newbie Greeter", "#6600CC", "", "]", "Cyan","","  Adding your new greeting: "..newGreet)
	
	-- Save the new variable
	SetVariable("greet_list",serialize.save("greetings"))
	SaveState()
end

function del_greeting(name, line, args)
	-- Which to remove?
	delNo = tonumber(args.messageNo)
	
	-- Load the greetings
	loadstring(GetVariable("greet_list"))
	
	if greetings[delNo] == nil then
		-- Let the user know
		ColourNote("#6600CC", "", "[", "#66FF66", "", "Newbie Greeter", "#6600CC", "", "]", "Red","","  Error: You supplied an invalid option to delete")
	else
		-- Let the user know
		ColourNote("#6600CC", "", "[", "#66FF66", "", "Newbie Greeter", "#6600CC", "", "]", "Cyan","","  Removing the greeting: "..greetings[delNo])
		
		-- Save the new variable
		table.remove(greetings,delNo)
		SaveState()
	end
end

function list_greeting(name, line, args)
	-- Get the list of greetings
	loadstring(GetVariable("greet_list"))
	
	for k, v in pairs (greetings) do
		-- Print the greetings
		ColourNote("Red","",k..") "..v)
	end
end

function OnPluginInstall()	
	-- Get the list of greetings
	greetList = GetVariable("greet_list")
	
	if greetList == nil then
		ColourNote("#6600CC", "", "[", "#66FF66", "", "Newbie Greeter", "#6600CC", "", "]", "White", "", "  Initializing Table")
		-- Initialize the table
		greetings = {}
		
		-- Some generic greetings!
		table.insert(greetings,"Welcome to Aardwolf, __PLAYERNAME__!")
		table.insert(greetings,"Welcome to Aardwolf, __PLAYERNAME__! This is the newbie channel, to type here you use newbie yourtext")
		table.insert(greetings,"Welcome to the wonderful world of Aardwolf, __PLAYERNAME__!")
		table.insert(greetings,"Welcome to the magical world of Aardwolf, __PLAYERNAME__!")
		SetVariable("greet_list",serialize.save("greetings"))	
		SaveState()
	else
		ColourNote("#6600CC", "", "[", "#66FF66", "", "Newbie Greeter", "#6600CC", "", "]", "White", "", "  Previously installed, using old table")
		loadstring(greetList) ()
	end
	
	
	DoAfterSpecial(.2, "help()", 12)

end


function help()
	Note()
	ColourNote("gray", "", string.rep("-", 80))
	ColourNote("#6600CC", "", "[", "#66FF66", "", "Newbie Greeter", "#6600CC", "", "]")
	ColourNote("gray", "", string.rep("-", 80))
	ColourNote("white", "", "This plugin will allow you to randomly greet the newbies!")
	ColourNote("white", "", "")
	ColourNote("white", "", "The commands are as follows:")	
	ColourNote("white", "", "")
	ColourNote("white", "", "ngreet playername   --   This will randomly greet a new player")
	ColourNote("white", "", "")
	ColourNote("white", "", "ngreet list   --   This will display your list of greetings")
	ColourNote("white", "", "")
	ColourNote("white", "", "ngreet add message   --   This will add a new greeting message.")
	ColourNote("white", "", "	Special note:  Use __PLAYERNAME__ as the variable that will be replaced by playername!")
	ColourNote("white", "", " You can also use color codes within the text if you desire.")
	ColourNote("white", "", "")
	ColourNote("white", "", "ngreet del messageno   --  This will deleted the message at a given index")
	ColourNote("white", "", "")
	ColourNote("white", "", "ngreet help   --  Displays this help menu")
	ColourNote("white", "", "")
	ColourNote("gray", "", string.rep("-", 80))
	Note()

end

]]>

</script>

</muclient>
